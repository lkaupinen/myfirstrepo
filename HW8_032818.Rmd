---
title: 'Homework #8'
author: "Lange Kaupinen"
date: "March 28, 2018"
output: word_document
---

```{r, include=FALSE, warning=FALSE}
# Load Libraries
library(ggplot2)
library(ggpubr)
library(tidyverse)
library(lubridate)
library(readr)
library(readxl)
library(stringr)
library(purrr)
library(nycflights13)
library(Lahman)
library(magrittr)
library(shiny)
library(shinydashboard)
library(broom)
library(modelr)
library(splines)
library(dplyr)
library(gapminder)
options(na.action = na.warn)
```

Assignment. I have attached a word document with the outline of what you should get and what needs to be done. You will need to fill in the function and code required to get the desired result. Happy snow day! As usual, please upload both your .Rmd and either a .pdf or a .doc of the knitted result.

Look at https://www.gapminder.org

Play with using this for different datasets and countries https://www.gapminder.org/data/

1. Download data for average systolic blood pressure for women and the GDP per capita (both from World bank and the alternative GDP per capita) and add it to the gapminder tibble.

2. Determine if the current working directory has a data folder.  If not, make one.

```{r, warning=FALSE}
if(!file.exists("./data")) {dir.create("./data")}
```

3. These are the urls you should have saved.  If not, go to the gapminder website and find the URLs we discussed in class for alt_GDP, women's blood pressure, and GDP per capita.  

```{r, warning=FALSE}
fileUrls <- c("https://docs.google.com/spreadsheet/pub?key=tSUr_yZVbM6a3AGJEq_Z2Pw&output=xlsx",
         "https://docs.google.com/spreadsheet/pub?key=0ArfEDsV3bBwCdHBzUVVSMDlTX1ZCUnNJQ3ZFdkFXVFE&output=xlsx",
         "https://docs.google.com/spreadsheet/pub?key=0AkBd6lyS3EmpdHo5S0J6ekhVOF9QaVhod05QSGV4T3c&output=xlsx")
```

4. Save the variable names into a vector.  

```{r, warning=FALSE}
var_names <- c("alt_GDP","blood_press","GDP")
```

5. Fill in the function get_clean to download and read in the excel file from the url provided and then put the data in a column with the variable name specified in var_name.  

```{r, warning=FALSE}
get_clean <- function(url_in, var_name){
  download.file(url_in, destfile = 'data/temp.xlsx', mode='wb')
  gc <- read_excel('data/temp.xlsx')
  gc <- gc %>% gather(colnames(gc)[2:ncol(gc)], key='year', value=!!var_name,na.rm = T)
  colnames(gc)[1] <- 'country'
  gc <- gc %>% arrange(country)
  gc$year <- as.integer(gc$year)
  return(gc)
}
```

6. Testing line - try it out with the first entry in fileUrls and var_names to get:  

```{r, warning=FALSE}
out1 <- get_clean(fileUrls[1],var_names[1])
head(out1)
```

7. Now use map2 to apply this function to the entire list of urls and names.  

```{r, warning=FALSE}
all_data <- map2(fileUrls, var_names, get_clean)
head(all_data)
```

8. Now we will join the data we got to the existing gapminder dataset.  You need to fill this code in to produce the desired result.  

```{r, warning=FALSE}
new_gapminder <- gapminder
for (i in seq_along(all_data)){
    all_data[[i]] <- full_join(gapminder,all_data[[i]])
    new_gapminder <- left_join(gapminder,all_data[[i]])
}

new_gapminder %>%
  arrange(country, year)
```